{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "task-status.schema.json",
  "title": "Task Status Schema",
  "description": "Schema for tracking individual task execution, artifacts, validations, and KPIs",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string"
    },
    "task_id": {
      "description": "Unique task identifier (e.g., ENV-002-AI, EXC-SEC-001)",
      "type": "string",
      "pattern": "^[A-Z]+-[A-Z0-9-]+$"
    },
    "section": {
      "description": "Task category/section",
      "type": "string"
    },
    "description": {
      "description": "Brief description of the task",
      "type": "string"
    },
    "owner": {
      "description": "Task owner or responsible party",
      "type": "string"
    },
    "sprint": {
      "description": "Sprint identifier (e.g., sprint-0)",
      "type": "string"
    },
    "phase": {
      "description": "Phase within the sprint (e.g., phase-1-ai-foundation)",
      "type": "string"
    },
    "stream": {
      "description": "Parallel stream identifier (e.g., parallel-a, parallel-b, parallel-c)",
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ]
    },
    "dependencies": {
      "type": "object",
      "properties": {
        "required": {
          "description": "List of prerequisite task IDs",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "verified_at": {
          "description": "ISO 8601 timestamp when dependencies were verified (null if not yet verified)",
          "anyOf": [
            {
              "type": "string",
              "format": "date-time",
              "pattern": "^(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))T(?:(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?(?:Z))$"
            },
            {
              "type": "null"
            }
          ]
        },
        "all_satisfied": {
          "description": "Whether all dependencies are satisfied",
          "type": "boolean"
        },
        "notes": {
          "description": "Additional notes about dependency status",
          "type": "string"
        }
      },
      "required": [
        "required",
        "all_satisfied"
      ],
      "additionalProperties": false
    },
    "dependencies_resolved": {
      "description": "List of resolved dependency task IDs (legacy compatibility)",
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "status": {
      "description": "Current task status",
      "type": "string",
      "enum": [
        "PLANNED",
        "Planned",
        "BACKLOG",
        "Backlog",
        "IN_PROGRESS",
        "In Progress",
        "VALIDATING",
        "Validating",
        "DONE",
        "Completed",
        "BLOCKED",
        "Blocked",
        "FAILED",
        "Failed",
        "NEEDS_HUMAN",
        "Needs Human",
        "IN_REVIEW",
        "In Review"
      ]
    },
    "started_at": {
      "description": "ISO 8601 timestamp when task execution started (null if not started)",
      "anyOf": [
        {
          "type": "string",
          "format": "date-time",
          "pattern": "^(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))T(?:(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?(?:Z))$"
        },
        {
          "type": "null"
        }
      ]
    },
    "completed_at": {
      "description": "ISO 8601 timestamp when task was completed (null if not completed)",
      "anyOf": [
        {
          "type": "string",
          "format": "date-time",
          "pattern": "^(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))T(?:(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?(?:Z))$"
        },
        {
          "type": "null"
        }
      ]
    },
    "target_duration_minutes": {
      "description": "Expected duration in minutes",
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "null"
        }
      ]
    },
    "actual_duration_minutes": {
      "description": "Actual duration in minutes",
      "anyOf": [
        {
          "type": "number"
        },
        {
          "type": "null"
        }
      ]
    },
    "status_history": {
      "description": "Chronological history of status changes",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "PLANNED",
              "Planned",
              "BACKLOG",
              "Backlog",
              "IN_PROGRESS",
              "In Progress",
              "VALIDATING",
              "Validating",
              "DONE",
              "Completed",
              "BLOCKED",
              "Blocked",
              "FAILED",
              "Failed",
              "NEEDS_HUMAN",
              "Needs Human",
              "IN_REVIEW",
              "In Review"
            ]
          },
          "at": {
            "type": "string",
            "format": "date-time",
            "pattern": "^(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))T(?:(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?(?:Z))$"
          },
          "note": {
            "type": "string"
          }
        },
        "required": [
          "status",
          "at"
        ],
        "additionalProperties": false
      }
    },
    "execution": {
      "type": "object",
      "properties": {
        "started_at": {
          "description": "When execution started (null if not started)",
          "anyOf": [
            {
              "type": "string",
              "format": "date-time",
              "pattern": "^(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))T(?:(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?(?:Z))$"
            },
            {
              "type": "null"
            }
          ]
        },
        "completed_at": {
          "description": "When execution completed (null if not completed)",
          "anyOf": [
            {
              "type": "string",
              "format": "date-time",
              "pattern": "^(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))T(?:(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?(?:Z))$"
            },
            {
              "type": "null"
            }
          ]
        },
        "duration_minutes": {
          "description": "Execution duration in minutes",
          "anyOf": [
            {
              "type": "number"
            },
            {
              "type": "null"
            }
          ]
        },
        "executor": {
          "description": "Who/what executed the task (human, agent, etc.)",
          "type": "string"
        },
        "agents": {
          "description": "List of AI agents involved in execution",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "execution_log": {
          "description": "Path to detailed execution log file",
          "type": "string"
        },
        "log_path": {
          "description": "Alternative path to execution log (alias for execution_log)",
          "type": "string"
        },
        "retry_count": {
          "description": "Number of retry attempts",
          "default": 0,
          "type": "integer",
          "minimum": 0,
          "maximum": 9007199254740991
        },
        "last_error": {
          "description": "Last error message if task failed (null if no error)",
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        }
      },
      "required": [
        "retry_count"
      ],
      "additionalProperties": false
    },
    "artifacts": {
      "type": "object",
      "properties": {
        "expected": {
          "description": "List of expected file paths or patterns",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "created": {
          "description": "Artifacts actually created with verification hashes",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "path": {
                "type": "string"
              },
              "sha256": {
                "type": "string",
                "pattern": "^[a-f0-9]{64}$"
              },
              "created_at": {
                "type": "string",
                "format": "date-time",
                "pattern": "^(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))T(?:(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?(?:Z))$"
              }
            },
            "required": [
              "path",
              "sha256",
              "created_at"
            ],
            "additionalProperties": false
          }
        },
        "missing": {
          "description": "Expected artifacts that were not created",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "validations": {
      "description": "Validation commands executed to verify task completion",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "command": {
            "type": "string"
          },
          "executed_at": {
            "type": "string",
            "format": "date-time",
            "pattern": "^(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))T(?:(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?(?:Z))$"
          },
          "exit_code": {
            "type": "integer",
            "minimum": -9007199254740991,
            "maximum": 9007199254740991
          },
          "duration_ms": {
            "type": "integer",
            "minimum": -9007199254740991,
            "maximum": 9007199254740991
          },
          "stdout_hash": {
            "description": "SHA256 hash of stdout for verification",
            "type": "string"
          },
          "passed": {
            "type": "boolean"
          }
        },
        "required": [
          "name",
          "command",
          "executed_at",
          "exit_code",
          "passed"
        ],
        "additionalProperties": false
      }
    },
    "kpis": {
      "description": "Key Performance Indicators for this task",
      "type": "object",
      "propertyNames": {
        "type": "string"
      },
      "additionalProperties": {
        "type": "object",
        "properties": {
          "target": {
            "description": "Target value for the KPI",
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "number"
              },
              {
                "type": "boolean"
              }
            ]
          },
          "actual": {
            "description": "Actual measured value",
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "number"
              },
              {
                "type": "boolean"
              }
            ]
          },
          "met": {
            "description": "Whether target was met",
            "type": "boolean"
          },
          "unit": {
            "type": "string"
          }
        },
        "required": [
          "target",
          "actual",
          "met"
        ],
        "additionalProperties": false
      }
    },
    "blockers": {
      "description": "Any blockers encountered during task execution",
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "description": {
            "type": "string"
          },
          "raised_at": {
            "type": "string",
            "format": "date-time",
            "pattern": "^(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))T(?:(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?(?:Z))$"
          },
          "resolved_at": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time",
                "pattern": "^(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))T(?:(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?(?:Z))$"
              },
              {
                "type": "null"
              }
            ]
          },
          "resolution": {
            "type": "string"
          }
        },
        "required": [
          "description",
          "raised_at"
        ],
        "additionalProperties": false
      }
    },
    "notes": {
      "description": "Additional notes or context",
      "type": "string"
    }
  },
  "required": [
    "task_id",
    "status"
  ],
  "additionalProperties": false
}
