Excellent clarity, Talysson! Your answers reveal a **sophisticated, context-aware orchestration system** that eliminates guesswork entirely. Let me synthesize this into a comprehensive architecture.

---

## ğŸ¯ The Core Insight: No Suppositions

Your critical point changes everything:

> *"dynamically insert the content for each task on the prompt because the task name and description has no total content the agents need"*

This means we need a **Context Hydration Layer** before any agent discussion begins. The task metadata from the CSV is just a *pointer* â€” the real content must be extracted from:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CONTEXT HYDRATION SOURCES                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1. TASK METADATA (from Sprint_plan.csv)                                    â”‚
â”‚     â””â”€â”€ Task ID, Owner Role, Dependencies, DoD, KPIs, Target Sprint         â”‚
â”‚                                                                             â”‚
â”‚  2. DEPENDENCY ARTIFACTS (from completed predecessor tasks)                 â”‚
â”‚     â””â”€â”€ {DEP_ID}-spec.md, {DEP_ID}-plan.md, {DEP_ID}-delivery.md           â”‚
â”‚     â””â”€â”€ Code files created by dependencies                                  â”‚
â”‚     â””â”€â”€ Test files and validation results                                   â”‚
â”‚                                                                             â”‚
â”‚  3. CODEBASE ANALYSIS (live scan)                                           â”‚
â”‚     â””â”€â”€ Relevant existing patterns (grep for domain keywords)               â”‚
â”‚     â””â”€â”€ Package structure and exports                                       â”‚
â”‚     â””â”€â”€ Type definitions and schemas                                        â”‚
â”‚     â””â”€â”€ Similar implementations (for consistency)                           â”‚
â”‚                                                                             â”‚
â”‚  4. PROJECT KNOWLEDGE (static)                                              â”‚
â”‚     â””â”€â”€ CLAUDE.md (project philosophy)                                      â”‚
â”‚     â””â”€â”€ Architecture docs                                                   â”‚
â”‚     â””â”€â”€ Domain model definitions                                            â”‚
â”‚     â””â”€â”€ API contracts and schemas                                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ Refined Architecture: The Daily Orchestrator

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INTELLIFLOW DAILY ORCHESTRATOR v2                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     PHASE 0: CONTEXT HYDRATION                        â”‚  â”‚
â”‚  â”‚                     (Automated - No Human Input)                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚   â”‚ Parse Task  â”‚ â†’  â”‚ Resolve     â”‚ â†’  â”‚ Scan Codebase for       â”‚   â”‚  â”‚
â”‚  â”‚   â”‚ from CSV    â”‚    â”‚ Dependenciesâ”‚    â”‚ Relevant Patterns       â”‚   â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚          â”‚                  â”‚                       â”‚                 â”‚  â”‚
â”‚  â”‚          â–¼                  â–¼                       â–¼                 â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚   â”‚              HYDRATED CONTEXT DOCUMENT                          â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â€¢ Task metadata + full dependency chain artifacts              â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â€¢ Relevant code snippets from codebase                         â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â€¢ Type definitions and schemas                                 â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â€¢ Integration points identified                                â”‚ â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     PHASE 0.5: AGENT SELECTION                        â”‚  â”‚
â”‚  â”‚                     (Dynamic based on task domain)                    â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   Task Domain Analysis â†’ Select Optimal Agent Composition             â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   BACKEND task?     â†’ [Architect, Backend-Lead, Test-Engineer]        â”‚  â”‚
â”‚  â”‚   FRONTEND task?    â†’ [Architect, UI-Lead, A11y-Expert, Test-Eng]     â”‚  â”‚
â”‚  â”‚   AI/ML task?       â†’ [AI-Specialist, Data-Engineer, Architect]       â”‚  â”‚
â”‚  â”‚   SECURITY task?    â†’ [Security-Lead, Architect, Compliance]          â”‚  â”‚
â”‚  â”‚   INFRA task?       â†’ [DevOps-Lead, Architect, SRE]                   â”‚  â”‚
â”‚  â”‚   CROSS-CUTTING?    â†’ [All domain leads relevant to task]             â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   + Always: Domain-Expert (CRM business logic)                        â”‚  â”‚
â”‚  â”‚   + If high-risk: Security-Lead (even for non-security tasks)         â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     PHASE 1: SPEC SESSION                             â”‚  â”‚
â”‚  â”‚                     (Round-Based + Topic Integration)                 â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   ROUND 1: ANALYSIS (Topic: Understanding the Task)                   â”‚  â”‚
â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚
â”‚  â”‚   Each agent analyzes the hydrated context and provides:              â”‚  â”‚
â”‚  â”‚   â€¢ Their domain-specific interpretation                              â”‚  â”‚
â”‚  â”‚   â€¢ Questions that need answers                                       â”‚  â”‚
â”‚  â”‚   â€¢ Initial concerns or risks                                         â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   ROUND 2: PROPOSAL (Topic: Technical Approach)                       â”‚  â”‚
â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚
â”‚  â”‚   Each agent proposes their domain's contribution:                    â”‚  â”‚
â”‚  â”‚   â€¢ Concrete implementation approach                                  â”‚  â”‚
â”‚  â”‚   â€¢ Integration requirements                                          â”‚  â”‚
â”‚  â”‚   â€¢ Dependencies on other agents' work                                â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   ROUND 3: CHALLENGE (Topic: Risk & Edge Cases)                       â”‚  â”‚
â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚
â”‚  â”‚   Agents challenge each other's proposals:                            â”‚  â”‚
â”‚  â”‚   â€¢ "What happens if X fails?"                                        â”‚  â”‚
â”‚  â”‚   â€¢ "How does this integrate with Y?"                                 â”‚  â”‚
â”‚  â”‚   â€¢ "What about edge case Z?"                                         â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   ROUND 4: CONSENSUS (Topic: Unified Specification)                   â”‚  â”‚
â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚
â”‚  â”‚   Agents synthesize into unified spec:                                â”‚  â”‚
â”‚  â”‚   â€¢ Agreed approach                                                   â”‚  â”‚
â”‚  â”‚   â€¢ Clear acceptance criteria                                         â”‚  â”‚
â”‚  â”‚   â€¢ Integration contract                                              â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   ROUND N: ITERATE until 100% consensus                               â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   OUTPUT: {TASK_ID}-spec.md (saved to .specify/sprints/sprint-{N}/specifications/) â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     PHASE 2: PLAN SESSION                             â”‚  â”‚
â”‚  â”‚                     (Owner Creates Execution Plan)                    â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   INPUT: Spec document + Hydrated context                             â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   Task Owner decomposes spec into:                                    â”‚  â”‚
â”‚  â”‚   â€¢ Ordered implementation steps                                      â”‚  â”‚
â”‚  â”‚   â€¢ File-by-file creation plan                                        â”‚  â”‚
â”‚  â”‚   â€¢ Test-first requirements (TDD red-green-refactor)                  â”‚  â”‚
â”‚  â”‚   â€¢ Integration checkpoints                                           â”‚  â”‚
â”‚  â”‚   â€¢ Validation criteria per step                                      â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   OUTPUT: {TASK_ID}-plan.md (saved to .specify/sprints/sprint-{N}/planning/)  â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     PHASE 3: EXEC SESSION                             â”‚  â”‚
â”‚  â”‚                     (Code Delivery & Validation)                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   INPUT: Spec + Plan + Hydrated context                               â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   Executor follows plan step-by-step:                                 â”‚  â”‚
â”‚  â”‚   â€¢ Write failing test (RED)                                          â”‚  â”‚
â”‚  â”‚   â€¢ Implement minimal code (GREEN)                                    â”‚  â”‚
â”‚  â”‚   â€¢ Refactor for quality (REFACTOR)                                   â”‚  â”‚
â”‚  â”‚   â€¢ Validate against spec criteria                                    â”‚  â”‚
â”‚  â”‚   â€¢ Update integration points                                         â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   VALIDATION GATE:                                                    â”‚  â”‚
â”‚  â”‚   â€¢ All tests pass                                                    â”‚  â”‚
â”‚  â”‚   â€¢ Spec acceptance criteria met                                      â”‚  â”‚
â”‚  â”‚   â€¢ Integration points verified                                       â”‚  â”‚
â”‚  â”‚   â€¢ DoD from CSV satisfied                                            â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚   OUTPUT: Code files + {TASK_ID}-delivery.md (saved to attestations/{TASK_ID}/) â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ The Context Hydration Engine

This is the **critical innovation** â€” a prompt section that dynamically builds complete context:

```markdown
## CONTEXT HYDRATION PROTOCOL

Before any agent discussion begins, execute this discovery:

### Step 1: Task Metadata Extraction
```
FROM: Sprint_plan.csv
EXTRACT:
  - Task ID: {TASK_ID}
  - Description: {DESCRIPTION}
  - Owner Role: {OWNER}
  - Dependencies: {CLEAN_DEPENDENCIES}
  - Definition of Done: {DOD}
  - KPIs: {KPIS}
  - Target Sprint: {SPRINT}
  - Complexity: {COMPLEXITY}
```

### Step 2: Dependency Chain Resolution
```
FOR EACH dependency in {CLEAN_DEPENDENCIES}:
  LOCATE: .specify/sprints/sprint-{DEP_SPRINT}/
  LOAD:
    - specifications/{DEP_ID}-spec.md  â†’ Understand what was specified
    - planning/{DEP_ID}-plan.md        â†’ Understand how it was planned
    - attestations/{DEP_ID}/           â†’ Understand validation & delivery
    - Code files created               â†’ Understand actual implementation

  EXTRACT:
    - Interfaces exposed
    - Types/schemas defined
    - Integration points created
    - Patterns established
```

### Step 3: Codebase Pattern Discovery
```
SCAN codebase for:
  - Similar implementations (by keyword matching task description)
  - Existing patterns in target domain
  - Type definitions relevant to task
  - Test patterns to follow
  
LOCATIONS to check:
  - /packages/{domain}/src/
  - /apps/{app}/src/
  - /packages/domain/src/
  - /packages/validators/src/
```

### Step 4: Project Knowledge Loading
```
LOAD:
  - /CLAUDE.md â†’ Project philosophy
  - /docs/architecture/*.md â†’ Architecture decisions
  - /packages/domain/src/models/*.ts â†’ Domain models
  - /packages/validators/src/schemas/*.ts â†’ Validation schemas
```

### Step 5: Build Hydrated Context Document
```
OUTPUT: Complete context including:
  - Full task requirements (not just CSV description)
  - All dependency artifacts and their outputs
  - Relevant existing code patterns
  - Integration points to connect to
  - Constraints from project standards
```
```

---

## ğŸ¤– Dynamic Agent Selection Algorithm

```typescript
interface AgentProfile {
  role: string;
  expertise: string[];
  whenToInclude: (task: Task, context: HydratedContext) => boolean;
}

const AGENT_POOL: AgentProfile[] = [
  {
    role: "Backend-Architect",
    expertise: ["system design", "API design", "database", "tRPC"],
    whenToInclude: (task) => 
      task.domain.includes("backend") || 
      task.description.match(/API|router|endpoint|database|prisma/i)
  },
  {
    role: "Frontend-Lead",
    expertise: ["React", "Next.js", "UI/UX", "components"],
    whenToInclude: (task) => 
      task.domain.includes("frontend") ||
      task.description.match(/component|page|UI|form|dashboard/i)
  },
  {
    role: "AI-Specialist",
    expertise: ["LangChain", "embeddings", "prompts", "ML"],
    whenToInclude: (task) => 
      task.domain.includes("ai") ||
      task.description.match(/AI|ML|embedding|vector|langchain|model/i)
  },
  {
    role: "Security-Lead",
    expertise: ["auth", "validation", "OWASP", "encryption"],
    whenToInclude: (task) => 
      task.domain.includes("security") ||
      task.isHighRisk ||
      task.description.match(/auth|permission|role|encrypt|sanitize/i)
  },
  {
    role: "Domain-Expert",
    expertise: ["CRM", "leads", "contacts", "sales", "business logic"],
    whenToInclude: () => true // Always included for CRM context
  },
  {
    role: "Test-Engineer",
    expertise: ["TDD", "Vitest", "Playwright", "coverage"],
    whenToInclude: () => true // Always included for quality
  },
  {
    role: "DevOps-Lead",
    expertise: ["Docker", "CI/CD", "infrastructure", "deployment"],
    whenToInclude: (task) => 
      task.domain.includes("infra") ||
      task.description.match(/docker|deploy|CI|pipeline|config/i)
  },
  {
    role: "Data-Engineer",
    expertise: ["Prisma", "migrations", "queries", "pgvector"],
    whenToInclude: (task) =>
      task.description.match(/schema|migration|query|database|model/i)
  }
];

function selectAgents(task: Task, context: HydratedContext): AgentProfile[] {
  const selected = AGENT_POOL.filter(agent => 
    agent.whenToInclude(task, context)
  );
  
  // Ensure minimum of 3 agents for healthy discussion
  if (selected.length < 3) {
    // Add Architect if not present
    if (!selected.find(a => a.role === "Backend-Architect")) {
      selected.push(AGENT_POOL.find(a => a.role === "Backend-Architect")!);
    }
  }
  
  // Cap at 5 agents to avoid chaos
  return selected.slice(0, 5);
}
```

---

## ğŸ“‹ Prompt Templates

### Phase 1: Spec Session Prompt Template

```markdown
# SPECIFICATION SESSION: {TASK_ID}

## SESSION METADATA
- Task: {TASK_ID} - {TASK_DESCRIPTION}
- Owner Role: {OWNER_ROLE}
- Target Sprint: {SPRINT}
- Complexity: {COMPLEXITY}
- Session Started: {TIMESTAMP}

---

## HYDRATED CONTEXT

### Task Requirements
{TASK_METADATA_FROM_CSV}

### Definition of Done (Contract)
{DOD_FROM_CSV}

### KPIs (Measurable Success)
{KPIS_FROM_CSV}

### Dependency Artifacts

#### From {DEP_1_ID}:
```
{DEP_1_SPEC_SUMMARY}
{DEP_1_DELIVERED_INTERFACES}
{DEP_1_CODE_PATTERNS}
```

#### From {DEP_2_ID}:
```
{DEP_2_SPEC_SUMMARY}
{DEP_2_DELIVERED_INTERFACES}
{DEP_2_CODE_PATTERNS}
```

### Relevant Existing Code

#### Existing Patterns:
```typescript
{RELEVANT_CODE_SNIPPETS}
```

#### Type Definitions:
```typescript
{RELEVANT_TYPES}
```

#### Integration Points:
```typescript
{EXISTING_INTEGRATION_POINTS}
```

### Project Standards
{CLAUDE_MD_RELEVANT_SECTIONS}
{ARCHITECTURE_CONSTRAINTS}

---

## PARTICIPATING AGENTS

{DYNAMICALLY_SELECTED_AGENTS_WITH_ROLES}

---

## DISCUSSION PROTOCOL

### ROUND 1: ANALYSIS
Topic: Understanding the Task Completely

Each agent must analyze the hydrated context and provide:
1. **Interpretation**: How you understand this task from your domain perspective
2. **Questions**: What's unclear or needs clarification?
3. **Concerns**: Initial risks or challenges you foresee
4. **Dependencies**: What do you need from other agents?

Format your response as:
```
@{AGENT_ROLE}:

**My Interpretation:**
[Your domain-specific understanding]

**Questions Requiring Answers:**
- [Question 1]
- [Question 2]

**Concerns:**
- [Risk/Challenge 1]

**I Need From Other Agents:**
- From @{OTHER_AGENT}: [What you need]
```

### ROUND 2: PROPOSAL
Topic: Technical Approach

Each agent proposes their contribution:
1. **Approach**: Concrete implementation strategy
2. **Files**: What files will be created/modified
3. **Interfaces**: What contracts you'll expose
4. **Integration**: How you connect to other agents' work

### ROUND 3: CHALLENGE
Topic: Stress Testing the Proposals

Agents cross-examine each other:
- Challenge assumptions
- Identify edge cases
- Question integration points
- Probe for security/performance issues

### ROUND 4+: CONSENSUS
Topic: Unified Specification

Iterate until all agents agree on:
- âœ… Complete technical approach
- âœ… Clear acceptance criteria
- âœ… Integration contracts defined
- âœ… All questions answered
- âœ… All risks addressed

---

## OUTPUT REQUIREMENTS

Generate a specification document with this structure:

```markdown
# Specification: {TASK_ID}

## Overview
[One paragraph summary]

## Technical Approach
[Agreed implementation strategy]

## Components to Create
| Component | Type | Location | Purpose |
|-----------|------|----------|---------|
| ... | ... | ... | ... |

## Interfaces & Contracts
```typescript
// Types this task will expose
```

## Integration Points
| Integrates With | How | Contract |
|-----------------|-----|----------|
| ... | ... | ... |

## Acceptance Criteria
- [ ] Criterion 1 (maps to DoD item 1)
- [ ] Criterion 2 (maps to DoD item 2)

## Test Requirements
- Unit tests for: [list]
- Integration tests for: [list]
- Edge cases to cover: [list]

## Risks & Mitigations
| Risk | Mitigation |
|------|------------|
| ... | ... |

## Agent Sign-off
- [ ] @Backend-Architect: Approved
- [ ] @Domain-Expert: Approved
- [ ] @Test-Engineer: Approved
```

---

## BEGIN ROUND 1

Agents, analyze the hydrated context above and provide your Round 1 responses.
```

---

### Phase 2: Plan Session Prompt Template

```markdown
# PLANNING SESSION: {TASK_ID}

## SESSION METADATA
- Task: {TASK_ID}
- Spec Document: {TASK_ID}-spec.md
- Owner: {OWNER_ROLE}
- Session Started: {TIMESTAMP}

---

## INPUTS

### Specification (from Phase 1)
{FULL_SPEC_DOCUMENT}

### Hydrated Context (carried forward)
{HYDRATED_CONTEXT_SUMMARY}

### TDD Requirements
All implementation must follow Red-Green-Refactor:
1. Write failing test first
2. Implement minimal code to pass
3. Refactor for quality

---

## PLANNING REQUIREMENTS

Create an execution plan that:

1. **Decomposes** the spec into ordered steps
2. **Sequences** steps to support TDD workflow
3. **Identifies** checkpoints for validation
4. **Specifies** exact file paths and contents outline
5. **Maps** each step to spec acceptance criteria

---

## OUTPUT: EXECUTION PLAN

```markdown
# Execution Plan: {TASK_ID}

## Pre-flight Checks
- [ ] Dependencies verified: {DEP_IDS}
- [ ] Target directories exist
- [ ] Required packages installed

## Implementation Steps

### Step 1: {STEP_NAME}
**Type**: Test | Implementation | Integration | Validation
**Files**:
  - CREATE: `path/to/file.ts`
  - MODIFY: `path/to/existing.ts`
**TDD Phase**: RED | GREEN | REFACTOR
**Acceptance Criteria Addressed**: [AC-1, AC-2]
**Validation**:
  - [ ] Test runs and fails (RED)
  - [ ] Test passes after implementation (GREEN)

### Step 2: {STEP_NAME}
...

## Integration Checkpoints
| After Step | Verify | How |
|------------|--------|-----|
| Step 3 | Types compile | `pnpm type-check` |
| Step 5 | Tests pass | `pnpm test:unit` |
| Step 7 | Integration works | `pnpm test:integration` |

## Final Validation
- [ ] All acceptance criteria met
- [ ] All tests passing
- [ ] DoD from CSV satisfied
- [ ] Integration points verified

## Estimated Effort
| Phase | Time |
|-------|------|
| Tests | Xh |
| Implementation | Xh |
| Integration | Xh |
| Total | Xh |
```
```

---

### Phase 3: Exec Session Prompt Template

```markdown
# EXECUTION SESSION: {TASK_ID}

## SESSION METADATA
- Task: {TASK_ID}
- Spec: {TASK_ID}-spec.md
- Plan: {TASK_ID}-plan.md
- Session Started: {TIMESTAMP}

---

## INPUTS

### Specification
{FULL_SPEC_DOCUMENT}

### Execution Plan
{FULL_PLAN_DOCUMENT}

### Hydrated Context
{HYDRATED_CONTEXT}

---

## EXECUTION PROTOCOL

Follow the plan step-by-step. For each step:

1. **Announce** which step you're executing
2. **Write** the code as specified
3. **Validate** against step criteria
4. **Report** completion status

### Constraints
- Write ONLY files specified in the plan
- Follow existing patterns from hydrated context
- Maintain type safety throughout
- Include comprehensive error handling
- Add JSDoc comments for public APIs

### Quality Gates
Before marking step complete:
- [ ] Code compiles without errors
- [ ] Tests pass (if applicable)
- [ ] Follows project conventions
- [ ] Integrates with existing code

---

## OUTPUT REQUIREMENTS

After all steps complete, generate:

```markdown
# Delivery Report: {TASK_ID}

## Files Created
| File | Lines | Purpose |
|------|-------|---------|
| ... | ... | ... |

## Files Modified
| File | Changes | Reason |
|------|---------|--------|
| ... | ... | ... |

## Test Results
```
{TEST_OUTPUT}
```

## Acceptance Criteria Validation
| Criterion | Status | Evidence |
|-----------|--------|----------|
| AC-1 | âœ… PASS | Test xyz passes |
| AC-2 | âœ… PASS | Integration verified |

## DoD Validation
| DoD Item | Status | Evidence |
|----------|--------|----------|
| ... | âœ… PASS | ... |

## Integration Verification
| Integration Point | Status | Notes |
|-------------------|--------|-------|
| ... | âœ… WORKING | ... |

## Task Status
**COMPLETED** âœ…

Ready for: Next dependent task
```
```

---

## ğŸ“ Task Folder Structure

Tasks are organized by sprint (determined from Sprint_plan.csv "Target Sprint" column):

```
/.specify/sprints/sprint-{N}/
â”œâ”€â”€ specifications/
â”‚   â””â”€â”€ {TASK_ID}-spec.md        # Output of Phase 1 (Spec Session)
â”œâ”€â”€ planning/
â”‚   â””â”€â”€ {TASK_ID}-plan.md        # Output of Phase 2 (Plan Session)
â”œâ”€â”€ context/
â”‚   â””â”€â”€ {TASK_ID}/
â”‚       â”œâ”€â”€ hydrated-context.md  # Built by Phase 0
â”‚       â”œâ”€â”€ hydrated-context.json
â”‚       â””â”€â”€ agent-selection.json # Which agents were selected
â”œâ”€â”€ attestations/
â”‚   â””â”€â”€ {TASK_ID}/
â”‚       â”œâ”€â”€ {TASK_ID}-delivery.md    # Output of Phase 3 (Exec Session)
â”‚       â”œâ”€â”€ validation-report.json
â”‚       â””â”€â”€ test-results.json
â””â”€â”€ execution/
    â””â”€â”€ {TASK_ID}/               # Runtime execution artifacts
```

**Note**: The sprint number {N} comes from the task's "Target Sprint" in Sprint_plan.csv.
Legacy task folders (`.specify/{TASK_ID}/`) may exist for previously migrated tasks.

---

## ğŸ”„ Daily Workflow Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DAILY WORKFLOW EXECUTION                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  MORNING: Task Selection                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚  1. Load Sprint_plan.csv                                                    â”‚
â”‚  2. Filter tasks where:                                                     â”‚
â”‚     - Status = "Ready" or "In Progress"                                     â”‚
â”‚     - All dependencies have status = "Completed"                            â”‚
â”‚     - All dependency validations passed                                     â”‚
â”‚  3. Present ready tasks for the day                                         â”‚
â”‚                                                                             â”‚
â”‚  FOR EACH READY TASK:                                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚                                                                             â”‚
â”‚  SESSION 1: Spec (separate Claude conversation)                             â”‚
â”‚  â”œâ”€â”€ Hydrate context automatically                                          â”‚
â”‚  â”œâ”€â”€ Select agents dynamically                                              â”‚
â”‚  â”œâ”€â”€ Run multi-round discussion                                             â”‚
â”‚  â”œâ”€â”€ Generate spec document                                                 â”‚
â”‚  â””â”€â”€ Save to .specify/sprints/sprint-{N}/specifications/            â”‚
â”‚                                                                             â”‚
â”‚  SESSION 2: Plan (separate Claude conversation)                             â”‚
â”‚  â”œâ”€â”€ Load spec from previous session                                        â”‚
â”‚  â”œâ”€â”€ Owner creates execution plan                                           â”‚
â”‚  â”œâ”€â”€ Generate plan document                                                 â”‚
â”‚  â””â”€â”€ Save to .specify/sprints/sprint-{N}/planning/                  â”‚
â”‚                                                                             â”‚
â”‚  SESSION 3: Exec (separate Claude conversation)                             â”‚
â”‚  â”œâ”€â”€ Load spec + plan                                                       â”‚
â”‚  â”œâ”€â”€ Execute step-by-step                                                   â”‚
â”‚  â”œâ”€â”€ Validate against criteria                                              â”‚
â”‚  â”œâ”€â”€ Generate delivery report                                               â”‚
â”‚  â””â”€â”€ Save to .specify/sprints/sprint-{N}/attestations/{TASK_ID}/    â”‚
â”‚                                                                             â”‚
â”‚  END OF DAY: Status Update                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚  1. Update Sprint_plan.csv with task statuses                               â”‚
â”‚  2. Re-calculate which tasks are now ready                                  â”‚
â”‚  3. Generate daily summary report                                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

