# Workflow Automation Configuration for IntelliFlow CRM
# Defines automated workflows for AI-assisted development processes

version: 1.0
project: intelliflow-crm

# GitHub Copilot Automation Workflows
copilot_workflows:
  # Code Review Automation
  code_review:
    enabled: true
    trigger: pull_request
    conditions:
      - event: opened
      - event: synchronize
      - draft: false
    steps:
      - name: AI Code Review
        action: copilot_review
        config:
          focus_areas:
            - security_vulnerabilities
            - type_safety
            - test_coverage
            - performance_issues
            - domain_boundary_violations
            - code_complexity
          severity_threshold: warning
          auto_comment: true
          block_merge_on: error

      - name: Suggest Improvements
        action: copilot_suggest
        config:
          areas:
            - refactoring_opportunities
            - test_improvements
            - documentation_gaps
          max_suggestions: 5

      - name: Check Architecture Compliance
        action: custom_check
        script: scripts/check-architecture.ts
        config:
          rules:
            - domain_independence
            - repository_pattern_usage
            - bounded_context_respect

  # Test Generation Workflow
  test_generation:
    enabled: true
    trigger: push
    conditions:
      - files_changed: "**/*.ts"
      - exclude: "**/*.test.ts"
      - exclude: "**/*.spec.ts"
    steps:
      - name: Detect Missing Tests
        action: analyze_coverage
        config:
          threshold: 90
          report_format: json

      - name: Generate Test Suggestions
        action: copilot_generate
        config:
          type: tests
          framework: vitest
          include:
            - unit_tests
            - integration_tests
            - edge_cases
          output: suggestions/tests-{timestamp}.md

      - name: Create Test PR
        action: auto_pr
        condition: missing_coverage > 10
        config:
          title: "ðŸ§ª Add missing tests for {file_path}"
          branch: auto/tests-{file_hash}
          assignee: original_author
          labels: [automated, tests, needs-review]

  # Documentation Sync Workflow
  documentation_sync:
    enabled: true
    trigger: push
    conditions:
      - branch: main
      - files_changed: "packages/**/*.ts"
    steps:
      - name: Extract API Changes
        action: diff_analysis
        config:
          detect:
            - new_exports
            - changed_signatures
            - deprecated_functions

      - name: Update Documentation
        action: copilot_docs
        config:
          targets:
            - api_reference
            - type_definitions
            - usage_examples
          format: markdown
          output_dir: docs/api

      - name: Update CHANGELOG
        action: changelog_update
        config:
          sections:
            - added
            - changed
            - deprecated
          format: conventional_commits

  # Commit Message Enhancement
  commit_enhancement:
    enabled: true
    trigger: pre_commit
    steps:
      - name: Analyze Changes
        action: git_diff_analysis
        config:
          scope: staged

      - name: Generate Commit Message
        action: copilot_commit_message
        config:
          format: conventional
          include:
            - type
            - scope
            - description
            - breaking_changes
          max_length: 72

      - name: Validate Format
        action: commitlint
        config:
          rules: "@commitlint/config-conventional"

  # Dependency Update Workflow
  dependency_updates:
    enabled: true
    trigger: schedule
    schedule: "0 0 * * 1"  # Weekly on Monday
    steps:
      - name: Check Dependencies
        action: dependency_check
        config:
          types: [dependencies, devDependencies]
          sources: [npm, github]

      - name: Security Audit
        action: security_scan
        config:
          severity_threshold: moderate
          auto_fix: true

      - name: Generate Update PR
        action: auto_pr
        condition: updates_available
        config:
          title: "â¬†ï¸ Update dependencies"
          branch: auto/dependency-updates
          include_changelog: true
          run_tests: true
          labels: [dependencies, automated]

  # Code Refactoring Suggestions
  refactoring_suggestions:
    enabled: true
    trigger: schedule
    schedule: "0 0 * * 5"  # Weekly on Friday
    steps:
      - name: Analyze Code Complexity
        action: complexity_analysis
        config:
          threshold: 15
          metrics:
            - cyclomatic_complexity
            - cognitive_complexity
            - maintainability_index

      - name: Identify Refactoring Opportunities
        action: copilot_analyze
        config:
          patterns:
            - duplicate_code
            - long_functions
            - complex_conditionals
            - god_objects
          min_impact: medium

      - name: Create Refactoring Issues
        action: create_issues
        config:
          title_template: "â™»ï¸ Refactor: {component_name}"
          labels: [refactoring, code-quality, automated]
          assignee: team_rotation

# Claude Code Automation Workflows
claude_workflows:
  # Sprint Task Automation
  sprint_task_automation:
    enabled: true
    trigger: sprint_start
    steps:
      - name: Parse Sprint Plan
        action: csv_parse
        config:
          file: Sprint_plan.csv
          filter: current_sprint

      - name: Generate Task Breakdown
        action: claude_analyze
        config:
          prompt_template: ".claude/prompts/task-breakdown.md"
          output_format: structured

      - name: Create GitHub Issues
        action: create_issues_batch
        config:
          labels_from: task_type
          milestone_from: sprint_number
          estimate_from: time_budget

  # Architecture Review
  architecture_review:
    enabled: true
    trigger: pull_request
    conditions:
      - files_changed: "packages/domain/**"
      - files_changed: "docs/architecture/**"
    steps:
      - name: DDD Compliance Check
        action: claude_review
        config:
          context: ".claude/context/ddd-principles.md"
          checks:
            - domain_purity
            - bounded_context_boundaries
            - aggregate_rules
            - repository_pattern

      - name: Generate Architecture Report
        action: claude_report
        config:
          sections:
            - violations_found
            - suggestions
            - compliance_score
          output: artifacts/reports/arch-review-{pr_number}.md

  # AI Chain Optimization
  ai_chain_optimization:
    enabled: true
    trigger: manual
    steps:
      - name: Analyze AI Performance
        action: metrics_analysis
        config:
          source: artifacts/metrics/ai-metrics.csv
          metrics:
            - response_time
            - token_usage
            - cost_per_request
            - accuracy_score

      - name: Generate Optimization Suggestions
        action: claude_optimize
        config:
          focus:
            - prompt_engineering
            - caching_strategies
            - model_selection
            - batching_opportunities

      - name: Create Optimization PR
        action: auto_pr
        config:
          title: "âš¡ Optimize AI chains based on performance analysis"
          branch: auto/ai-optimization
          labels: [performance, ai, optimization]

# Integration Workflows
integration_workflows:
  # Codex Integration
  codex_review:
    enabled: true
    trigger: pull_request
    tool: codex
    steps:
      - name: Deep Code Analysis
        action: codex_analyze
        config:
          cli_config: tools/integrations/codex/cli-config.yaml
          prompts:
            - tools/integrations/codex/prompts/code-review.md
          output_format: json

      - name: Post Review Comments
        action: github_comment
        config:
          filter_severity: warning
          group_by: file

  # Jules Workflow Integration
  jules_analysis:
    enabled: true
    trigger: push
    tool: jules
    conditions:
      - branch: main
    steps:
      - name: Code Quality Analysis
        action: jules_workflow
        config:
          connection: tools/integrations/jules/connection.yaml
          workflow: tools/integrations/jules/workflows/code-analysis.yaml

      - name: Update Quality Metrics
        action: metrics_update
        config:
          target: artifacts/metrics/code-quality.csv
          append: true

# Notification Workflows
notifications:
  slack:
    enabled: true
    channels:
      development: "#intelliflow-dev"
      deployments: "#intelliflow-deploys"
      security: "#intelliflow-security"
    events:
      - type: pr_review_complete
        channel: development
        template: "ðŸ¤– AI Review Complete: {pr_title} - {review_status}"

      - type: test_coverage_below_threshold
        channel: development
        template: "âš ï¸ Test Coverage Alert: {coverage}% (threshold: 90%)"

      - type: security_vulnerability
        channel: security
        template: "ðŸš¨ Security Alert: {severity} vulnerability in {dependency}"

      - type: deployment_success
        channel: deployments
        template: "âœ… Deployment successful: {environment} - {version}"

  github:
    enabled: true
    events:
      - type: workflow_failure
        action: create_issue
        labels: [bug, automation, urgent]

      - type: quality_threshold_exceeded
        action: close_issue
        labels: [code-quality]

# Metrics Collection
metrics:
  collection:
    enabled: true
    frequency: hourly
    targets:
      - copilot_usage:
          metrics: [acceptance_rate, suggestions_count, time_saved]
          output: artifacts/metrics/copilot-usage.csv

      - claude_usage:
          metrics: [commands_run, success_rate, avg_execution_time]
          output: artifacts/metrics/claude-usage.csv

      - code_quality:
          metrics: [coverage, complexity, maintainability]
          output: artifacts/metrics/code-quality.csv

      - ai_performance:
          metrics: [latency, cost, accuracy, token_usage]
          output: artifacts/metrics/ai-performance.csv

  reporting:
    enabled: true
    frequency: weekly
    format: markdown
    output: artifacts/reports/weekly-metrics-{date}.md
    recipients:
      - team_lead
      - product_owner
    sections:
      - executive_summary
      - copilot_adoption
      - code_quality_trends
      - ai_cost_analysis
      - recommendations

# Error Handling and Recovery
error_handling:
  retry_policy:
    max_attempts: 3
    backoff: exponential
    initial_delay: 5s

  fallback_actions:
    - condition: copilot_api_down
      action: skip_workflow
      notification: true

    - condition: rate_limit_exceeded
      action: queue_for_later
      delay: 1h

    - condition: validation_failed
      action: create_issue
      labels: [automation-error, needs-investigation]

  monitoring:
    enabled: true
    alert_on:
      - workflow_failure_rate > 10%
      - avg_execution_time > 5m
      - error_count > 20/hour

# Security and Compliance
security:
  secrets_scanning:
    enabled: true
    trigger: pre_commit
    action: block_commit
    patterns:
      - api_keys
      - passwords
      - tokens
      - private_keys

  code_scanning:
    enabled: true
    trigger: push
    tools:
      - github_codeql
      - snyk
      - semgrep
    severity_threshold: medium

  compliance_checks:
    enabled: true
    rules:
      - no_secrets_in_code
      - license_compliance
      - dependency_audit
      - gdpr_compliance
