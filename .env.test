# IntelliFlow CRM - Test Environment Configuration
# This file is used for running automated tests
# Optimized for fast, isolated, deterministic testing

# ==============================================================================
# ENVIRONMENT
# ==============================================================================
NODE_ENV=test
ENVIRONMENT=test
DEBUG=false
LOG_LEVEL=error

# ==============================================================================
# DATABASE CONFIGURATION
# ==============================================================================
# Test database (separate from dev to avoid conflicts)
# Use different port to run alongside dev database
DATABASE_URL=postgresql://postgres:postgres@localhost:5433/intelliflow_test?schema=public
DIRECT_URL=postgresql://postgres:postgres@localhost:5433/intelliflow_test?schema=public
DATABASE_POOL_SIZE=5
DATABASE_SSL_MODE=disable

# Test database URL (used by some test utilities)
TEST_DATABASE_URL=postgresql://postgres:postgres@localhost:5433/intelliflow_test?schema=public

# Supabase (use mock/local instance for tests)
SUPABASE_URL=http://localhost:54322
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU
SUPABASE_JWT_SECRET=test-jwt-secret-with-at-least-32-characters

# Redis (separate instance for tests)
REDIS_URL=redis://localhost:6380
TEST_REDIS_URL=redis://localhost:6380
REDIS_PASSWORD=
REDIS_TLS_ENABLED=false

# ==============================================================================
# AI / LLM CONFIGURATION
# ==============================================================================
# Use mock AI provider for deterministic tests
AI_PROVIDER=mock

# Ollama (if needed for integration tests)
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=llama2
OLLAMA_EMBEDDING_MODEL=nomic-embed-text

# OpenAI (use test mode - will be mocked)
OPENAI_API_KEY=sk-test-key-for-testing-only
OPENAI_MODEL=gpt-4-turbo-preview
OPENAI_EMBEDDING_MODEL=text-embedding-3-small
OPENAI_MAX_TOKENS=1000
OPENAI_TEMPERATURE=0.0

# LangChain (disabled for tests)
LANGCHAIN_TRACING_V2=false
LANGCHAIN_PROJECT=intelliflow-test
LANGCHAIN_API_KEY=

# ==============================================================================
# AUTHENTICATION & AUTHORIZATION
# ==============================================================================
# NextAuth.js (test configuration)
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=test-secret-for-testing-environment-only

# JWT (test keys)
JWT_SECRET=test-jwt-secret
JWT_EXPIRATION=1h
JWT_REFRESH_EXPIRATION=2h

# OAuth (disabled in tests)
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=

# ==============================================================================
# API CONFIGURATION
# ==============================================================================
# tRPC API server (different port for tests)
API_PORT=3002
API_HOST=localhost
API_CORS_ORIGIN=http://localhost:3000

# Rate limiting (disabled for tests)
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=999999

# ==============================================================================
# FRONTEND CONFIGURATION
# ==============================================================================
# Next.js (test mode)
NEXT_PUBLIC_API_URL=http://localhost:3002
NEXT_PUBLIC_SUPABASE_URL=http://localhost:54322
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0
NEXT_PUBLIC_APP_URL=http://localhost:3000

# ==============================================================================
# OBSERVABILITY & MONITORING
# ==============================================================================
# Sentry (disabled for tests)
SENTRY_DSN=
SENTRY_ENVIRONMENT=test
SENTRY_TRACES_SAMPLE_RATE=0
SENTRY_DEBUG=false

# OpenTelemetry (disabled for tests)
OTEL_EXPORTER_OTLP_ENDPOINT=
OTEL_SERVICE_NAME=intelliflow-test
OTEL_TRACES_SAMPLER=always_off

# ==============================================================================
# FEATURE FLAGS
# ==============================================================================
# Test all features
FEATURE_AI_SCORING_ENABLED=true
FEATURE_EMAIL_AUTOMATION_ENABLED=true
FEATURE_ANALYTICS_ENABLED=true
FEATURE_EXPERIMENTAL_UI=true

# ==============================================================================
# EXTERNAL INTEGRATIONS
# ==============================================================================
# Email (mock provider)
EMAIL_PROVIDER=mock
EMAIL_FROM_ADDRESS=test@intelliflow.test
EMAIL_FROM_NAME=IntelliFlow CRM (Test)

# SMS (mock)
TWILIO_ACCOUNT_SID=test-account-sid
TWILIO_AUTH_TOKEN=test-auth-token
TWILIO_PHONE_NUMBER=+1234567890

# File storage (in-memory)
STORAGE_PROVIDER=memory

# AWS (mock credentials for tests)
AWS_ACCESS_KEY_ID=test-access-key
AWS_SECRET_ACCESS_KEY=test-secret-key
AWS_REGION=us-east-1
AWS_S3_BUCKET=test-bucket

# ==============================================================================
# SECURITY SETTINGS
# ==============================================================================
# Encryption (test keys)
ENCRYPTION_KEY=test-encryption-key-32-chars-min
ENCRYPTION_ALGORITHM=aes-256-gcm

# CORS (permissive for tests)
CORS_ALLOWED_ORIGINS=*
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS
CORS_ALLOWED_HEADERS=*

# Cookie settings
COOKIE_SECURE=false
COOKIE_SAME_SITE=lax
COOKIE_DOMAIN=localhost

# ==============================================================================
# PERFORMANCE TUNING
# ==============================================================================
# Minimal connection pooling for tests
DATABASE_MIN_POOL_SIZE=1
DATABASE_MAX_POOL_SIZE=5
DATABASE_IDLE_TIMEOUT=10000

# Caching (short TTL for tests)
CACHE_TTL=10
CACHE_MAX_SIZE=10

# AI request timeouts (shorter for faster tests)
AI_REQUEST_TIMEOUT=5000
AI_MAX_RETRIES=1
AI_RETRY_DELAY=100

# ==============================================================================
# TEST CONFIGURATION
# ==============================================================================
# Test-specific settings
TEST_TIMEOUT=30000
TEST_PARALLEL=true
TEST_MAX_WORKERS=4

# Mock external services
MOCK_EXTERNAL_APIS=true

# Disable external API calls
DISABLE_EXTERNAL_CALLS=true

# Test data seeding
AUTO_SEED_TEST_DATA=true

# Clean database between tests
CLEAN_DB_BETWEEN_TESTS=true
